;	TITLE	'serial test`
;	Scott Baker, www.smbaker.com
;
;	Test for sbx-351 serial board
;
;
; ISIS system calls
;
	EXTRN COUT
	EXTRN CIN
	EXTRN ZSOUT
	EXTRN COPEN
	EXTRN EXIT

	EXTRN PSPACE
	EXTRN PHEXA
	EXTRN PCRLF

CDATA  EQU	0A0H
CCMD   EQU	0A1H
CSTAT  EQU	0A1H

CSMUL  EQU	06EH
CSDIV  EQU	06FH

CR      EQU      0DH            ;CARRIAGE RETURN
LF      EQU      0AH            ;LINE FEED

	STKLN	100H				; Size of stack segment

	CSEG	

ORIG:	LXI	SP, STACK
	CALL	COPEN

	CALL	TEST1
	CALL	TEST2
	CALL	TEST3
	CALL	TEST4

	CALL 	EXIT

TEST1:	LXI	D, T1MSG
	CALL	ZSOUT

	MVI	A, 07H
	OUT	CDATA
	MVI	A, 00H
	OUT	CDATA
	MVI	A, 03H
	OUT	CDATA
	MVI	A, 00H
	OUT	CDATA

	MVI	A, CSMUL
	OUT	CCMD

	IN	CDATA		; high byte
	CALL	PHEXA
	IN	CDATA		; low byte
	CALL 	PHEXA
	CALL	PCRLF
	RET

TEST2:	LXI	D, T2MSG
	CALL	ZSOUT

	MVI	A, 23H
	OUT	CDATA
	MVI	A, 01H
	OUT	CDATA
	MVI	A, 45H
	OUT	CDATA
	MVI	A, 00H
	OUT	CDATA

	MVI	A, CSMUL
	OUT	CCMD

	IN	CDATA		; high byte
	CALL	PHEXA
	IN	CDATA		; low byte
	CALL 	PHEXA
	CALL	PCRLF
	RET

TEST3:	LXI	D, T3MSG
	CALL	ZSOUT

	MVI	A, 21H
	OUT	CDATA
	MVI	A, 43H
	OUT	CDATA
	MVI	A, 27H
	OUT	CDATA
	MVI	A, 01H
	OUT	CDATA

	MVI	A, CSDIV
	OUT	CCMD

	IN	CDATA		; high byte
	CALL	PHEXA
	IN	CDATA		; low byte
	CALL 	PHEXA
	CALL	PCRLF
	RET

TEST4:	LXI	D, T4MSG
	CALL	ZSOUT

	MVI	A, 11H
	OUT	CDATA
	MVI	A, 03H
	OUT	CDATA

	MVI	A, 32H
	OUT	CDATA
	MVI	A, 54H
	OUT	CDATA
	MVI	A, 33H
	OUT	CDATA
	MVI	A, 01H
	OUT	CDATA

	MVI	A, CSDIV
	OUT	CCMD

	MVI	A, CSMUL
	OUT	CCMD

	IN	CDATA		; high byte
	CALL	PHEXA
	IN	CDATA		; low byte
	CALL 	PHEXA
	CALL	PCRLF
	RET 

T1MSG:	DB	'(should be 0015) 0x0007 * 0x0003 = ', 0
T2MSG:	DB	'(should be 4E6F) 0x0123 * 0x0045 = ', 0
T3MSG:	DB	'(should be 003A) 0x4321 / 0x0127 = ', 0
T4MSG:	DB	'(should be D6A6) (0x5432 / 0x0133) * 0x0311 = ', 0

	END	ORIG
