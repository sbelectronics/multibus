$macrofile

;	TITLE	'tms`
;	Scott Baker, www.smbaker.com
;
;	Demo/Test for scott's TMS5220 module

; ISIS system calls
;
	EXTRN COUT
	EXTRN CIN
	EXTRN ZSOUT
	EXTRN COPEN
	EXTRN EXIT

	EXTRN TMSSTP
	EXTRN TMSSTR
	EXTRN TMSADR
	EXTRN TMSDLY
	EXTRN TMSEXT

	EXTRN V7NLZ
	EXTRN V7NUM
	EXTRN V7AM
	EXTRN V7TTIS

	EXTRN GOOD
	EXTRN MORNING

	EXTRN PHEXA
	EXTRN PSPACE

	EXTRN DOFLAG
	EXTRN FLAGA
	EXTRN FLAGD
	EXTRN FLAGG
	EXTRN FLAGR
	EXTRN FLAGS
	EXTRN FLAGT
	EXTRN FLAGZ

	STKLN	100H				; Size of stack segment

	CSEG

$INCLUDE(PORTS.INC)

ORIG:	LXI	SP, STACK
	CALL	COPEN
	CALL	DOFLAG

	CALL	TMSSTP

	LDA	FLAGA
	CPI	0FFH
	JZ	NOTA
	STA	PLAYED
	LXI	D, ACORN
	CALL	TMSEXT

NOTA:	LDA	FLAGD
	CPI	0FFH
	JZ	NOTD
	STA	PLAYED
	CALL	DUMP

NOTD:	LDA	FLAGG
	CPI	0FFH
	JZ	NOTG
	STA	PLAYED
	LXI	D, GOOD
	CALL	TMSEXT
	LXI	D, MORNING
	CALL	TMSEXT

NOTG:	LDA	FLAGR
	CPI	0FFH
	JZ	NOTR
	STA	PLAYED
	LXI	D, MTEST
	CALL	TMSSTR

NOTR:	LDA	FLAGS
	CPI	0FFH
	JZ	NOTS
	STA	PLAYED
	LXI	D,SCOTT
	CALL	TMSEXT
	LXI	D,WAS
	CALL	TMSEXT
	LXI	D,HERE
	CALL	TMSEXT

NOTS:	LDA	FLAGT
	CPI	0FFH
	JZ	NOTT
	STA	PLAYED
	CALL	TIMTST

NOTT:	LDA	FLAGZ
	CPI	0FFH
	JZ	NOTZ
	STA	PLAYED
	LXI	D, ZERO
	CALL	TMSEXT

NOTZ:	LDA	PLAYED
	CPI	0FFH
	JNZ	NOHELP
	LXI	D, HELP
	CALL	ZSOUT

NOHELP:	CALL	EXIT

HELP:	DB	'ARGS: C=CONTINUOUS, M=MUTE', 0DH, 0AH
        DB      '      (EXTERN) A=ACORN, Z=ZERO, G=GOOD MORN, T=TIME', 0DH, 0AH
	DB	'      (ROM) R=ROM TEST', 0DH, 0AH, 0

	; DUMP -- dumps part of the ACORN word from the ROM for debugging

DUMP:	LXI	B,0BB6H
DLP:	MOV	A,B
	CPI	00CH
	RZ
	CALL	TMSADR
	MVI	A,010H
	OUT	0B0H
	IN	0B0H
	CALL	PHEXA
	CALL	PSPACE
	INX	B		
	JMP	DLP

TIMTST: CALL	V7TTIS
	MVI	A,1
	CALL	V7NUM
	MVI	A,23
	CALL	V7NLZ
	CALL	V7AM
	RET

PLAYED: DB	0FFH

MAC:	DW	02409H  ; must
	DW	00BB6H  ; acorn
	DW	0FFFFH	

MTEST:	DW	03808H	; this
	DW	01F57H  ; is
	DW	00B5DH  ; a
	DW	02E3FH	; program
	DW	03153H	; running
	DW	02980H	; on
	DW	036DFH	; the
	DW	0140BH	; computer
	DW	0FFFFH  ; end

ACORN:  DW	LACORN
	DB      023H,09BH,035H,085H,0D3H,096H,09CH,064H
	DB	0D6H,012H,00AH,05FH,07CH,0A2H,095H,0D6H
        DB      030H,06CH,0F1H,089H,056H,018H,086H,0CCH
	DB	045H,02BH,05AH,0A1H,011H,02BH,01BH,0B7H
        DB      068H,034H,006H,0CFH,09EH,094H,0B2H,091H
	DB	019H,032H,0ABH,096H,02AH,084H,072H,077H
        DB      011H,0D9H,000H,00AH,008H,051H,0C9H,002H
	DB	025H,08FH,06DH,054H,04DH,066H,0B6H,022H
        DB      086H,009H,033H,0DAH,0D5H,0DAH,0E8H,02AH
	DB	0D3H,0B0H,04FH,0EBH,092H,0A9H,0CAH,0A0H
        DB      0BCH,06DH,048H,0A6H,02AH,083H,0F2H,095H
	DB	029H,0D9H,0ECH,034H,0ECH,09BH,0E6H,090H
        DB      0AAH,05DH,078H,073H,098H,063H,0C9H,074H
	DB	0D6H,057H,06EH,08EH,0CBH,042H,06CH,066H
        DB      0B9H,029H,00DH,04BH,0E6H,08EH,01BH,0C6H
	DB	094H,02CH,084H,0A2H,073H,098H,0B2H,071H
	DB	00BH,0F0H,0CCH,06EH,04EH,03AH,0D4H,0D8H
	DB	0B3H,0AAH,0B9H,068H,033H,023H,0D5H,0F2H
LACORN	EQU	$-ACORN

ZERO:	DW	LZERO
	DB      162,43,32,45,170,26,170,182
        DB      129,212,136,114,172,128,143,196
        DB      52,144,170,143,68,213,67,77
        DB      203,22,51,140,182,68,35,154
        DB      220,33,167,107,173,96,40,131
        DB      156,158,117,130,105,18,116,178
        DB      209,241,135,116,170,137,70,39
        DB      24,54,57,92,23,157,96,168
        DB      146,52,91,180,162,166,202,210
        DB      125,209,136,115,182,242,168,150
        DB      35,205,131,77,35,93,183,44
        DB      15,116,243,200,220,138,92,169
        DB      164,59,85,171,115,229,226,58
        DB      215,109,44,73,139,61,111,149
        DB      177,120,77,215,120,148,166,100
        DB      195,51,226,82,154,146,141,8
        DB      243,75,97,74,49,220,184,38
        DB      187,37,5,119,149,122,244,6
LZERO	EQU	$-ZERO

TEST:
	DW	LTEST
        DB      00cH,098H,041H,094H,0bcH,05dH,08aH,069H
        DB      0baH,065H,012H,065H,0c1H,05aH,0eeH,062H
        DB      05cH,01dH,0a4H,07bH,087H,09aH,049H,04dH
        DB      034H,09eH,05dH,06eH,038H,0b5H,049H,05bH
        DB      0d6H,044H,0a0H,0d4H,067H,06dH,091H,013H
        DB      081H,052H,09fH,0b4H,067H,08eH,007H,00aH
        DB      07dH,0f4H,05eH,059H,01eH,038H,0f4H,021H
        DB      065H,066H,09aH,091H,030H,084H,094H,099H
        DB      0e9H,046H,0c2H,014H,072H,046H,096H,01bH
        DB      071H,073H,048H,015H,0d9H,021H,0d4H,06dH
        DB      021H,094H,067H,0a7H,051H,073H,006H,09fH
        DB      019H,0d9H,042H,048H,0e5H,06dH,045H,064H
        DB      010H,046H,051H,091H,061H,01eH,069H,00bH
        DB      07dH,04dH,0a4H,087H,0a5H,06dH,0d4H,077H
        DB      051H,0e6H,01eH,049H,0d0H,0dfH,075H,0baH
        DB      06bH,0daH,041H,068H,0b7H,0e5H,06eH,019H
LTEST	EQU	$-TEST

SCOTT:
	DW	LSCOTT
	DB      000H,000H,000H,080H,080H,0dfH,0a6H,009H
        DB      0f0H,04bH,025H,001H,07eH,0aeH,060H,0c0H
        DB      02bH,099H,004H,0f8H,0d9H,083H,001H,03fH
        DB      07bH,008H,0e0H,0b8H,02cH,081H,04eH,05dH
        DB      02eH,0e1H,0a9H,001H,050H,033H,054H,089H
        DB      0a5H,0c5H,011H,069H,032H,02aH,05dH,01eH
        DB      037H,034H,031H,088H,077H,06bH,0c5H,0d0H
        DB      084H,062H,091H,0a5H,0a5H,05cH,017H,09bH
        DB      0a7H,0a7H,00fH,076H,05dH,09cH,0e1H,0d6H
        DB      05eH,0d8H,0f5H,071H,085H,06bH,067H,0e1H
        DB      0d0H,0c7H,019H,021H,09dH,045H,042H,01fH
        DB      067H,084H,076H,016H,071H,043H,09cH,019H
        DB      0daH,019H,038H,08cH,071H,064H,068H,07bH
        DB      090H,030H,0c6H,011H,061H,0edH,081H,0c3H
        DB      014H,05bH,084H,0b7H,007H,00eH,04bH,02aH
        DB      011H,0d9H,051H,0d0H,03dH,031H,086H,0d7H
        DB      044H,029H,0e6H,084H,094H,051H,013H,095H
        DB      051H,098H,073H,0baH,0a5H,085H
LSCOTT	EQU	$-SCOTT

WAS:
	DW	LWAS
	DB      000H,000H,068H,000H,0abH,043H,0d8H,0c3H
        DB      092H,09eH,04dH,037H,0ceH,036H,02aH,03aH
        DB      0d6H,0baH,084H,06aH,088H,0eaH,064H,099H
        DB      031H,0b0H,027H,0a6H,073H,0b1H,057H,020H
        DB      06fH,0bbH,0ceH,0c7H,05aH,086H,09eH,015H
        DB      0baH,050H,0baH,091H,0bbH,052H,0e8H,042H
        DB      0eeH,021H,0aeH,04aH,0a1H,00bH,0a1H,086H
        DB      0b5H,022H,0a6H,03eH,0baH,01aH,08aH,018H
        DB      099H,0faH,064H,0aaH,025H,0bcH,062H,0eaH
        DB      0a3H,0efH,094H,08eH,090H,0a9H,00fH,0beH
        DB      0c2H,02aH,042H,0a6H,03eH,0f8H,072H,0efH
        DB      00cH,098H,086H,018H,042H,063H,032H,060H
        DB      018H,0a2H,04dH,08bH,08dH,080H,061H,00cH
        DB      0a6H,023H,0c6H,00dH,086H,029H,0a8H,076H
        DB      0dfH,030H,0e9H,026H,0afH,0cbH,0e3H,032H
        DB      0a4H,09aH,055H,028H,0efH,0cdH,080H,062H
        DB      056H,036H,02dH,02fH,002H,0b2H,045H,0e8H
        DB      0b2H,0d8H,02cH,0c9H,016H,0a1H,0d2H,0a3H
        DB      0a3H,032H,09aH,099H,049H,0adH,08dH,040H
        DB      068H,086H,0c9H,062H,032H,085H,000H,000H
LWAS	EQU	$-WAS

HERE:	DW	LHERE
        DB      008H,06cH,058H,07cH,0cbH,0adH,010H,070H
        DB      070H,0b6H,032H,08bH,0c3H,082H,0c2H,042H
        DB      04dH,0ccH,089H,001H,013H,0e3H,0aaH,073H
        DB      0d3H,0aeH,048H,08cH,03bH,03fH,00cH,0bbH
        DB      022H,008H,0edH,07eH,017H,0ecH,00aH,02fH
        DB      06dH,0faH,04cH,070H,028H,0bcH,0f4H,0eeH
        DB      077H,043H,0a1H,0f0H,0d2H,0bbH,02fH,04dH
        DB      005H,0d7H,02bH,0cbH,0beH,08aH,014H,0caH
        DB      068H,0d9H,0faH,0d2H,056H,0a8H,0a2H,0e7H
        DB      0d8H,0b5H,098H,0a1H,08eH,091H,07dH,057H
        DB      01bH,084H,026H,015H,0d2H,05dH,04dH,018H
        DB      0daH,054H,048H,066H,025H,095H,06bH,053H
        DB      025H,0ddH,0a5H,04cH,0aeH,04bH,08dH,064H
        DB      086H,03aH,0b9H,03eH,036H,096H,059H,0ceH
        DB      064H,086H,0d0H,058H,066H,039H,093H,01aH
        DB      063H,067H,09eH,0e5H,04cH,00aH,08bH,083H
        DB      078H,056H,052H,031H,02cH,00eH,0e2H,05dH
        DB      0ceH,084H,084H,058H,005H,0fbH,0c8H,023H
        DB      0e2H,063H,00cH,0b0H,083H,00eH,000H,000H
LHERE	EQU	$-HERE

	END	ORIG
