$macrofile

;	TITLE	'tms`
;	Scott Baker, www.smbaker.com
;
;	For scott's TMS5220 module

; ISIS system calls
;
	EXTRN COUT
	EXTRN CIN
	EXTRN ZSOUT
	EXTRN COPEN
	EXTRN EXIT

	EXTRN TMSSTP
	EXTRN TMSSTR
	EXTRN TMSADR
	EXTRN TMSDLY
	EXTRN TMSEXT

	EXTRN PHEXA
	EXTRN PSPACE

	EXTRN DOFLAG
	EXTRN FLAGA
	EXTRN FLAGD
	EXTRN FLAGG
	EXTRN FLAGT
	EXTRN FLAGZ

	STKLN	100H				; Size of stack segment

	CSEG

$INCLUDE(PORTS.INC)

ORIG:	LXI	SP, STACK
	CALL	COPEN
	CALL	DOFLAG

	CALL	TMSSTP

	LDA	FLAGA
	CPI	0FFH
	JZ	NOTA
	STA	PLAYED
	LXI	D, ACORN
	CALL	TMSEXT

NOTA:	LDA	FLAGD
	CPI	0FFH
	JZ	NOTD
	STA	PLAYED
	CALL	DUMP

NOTD:	LDA	FLAGG
	CPI	0FFH
	JZ	NOTG
	LXI	D, GOOD
	CALL	TMSEXT
	LXI	D, MORNING
	CALL	TMSEXT

NOTG:	LDA	FLAGT
	CPI	0FFH
	JZ	NOTT
	STA	PLAYED
	LXI	D, MTEST
	CALL	TMSSTR

NOTT:	LDA	FLAGZ
	CPI	0FFH
	JZ	NOTZ
	STA	PLAYED
	LXI	D, ZERO
	CALL	TMSEXT

NOTZ:	LDA	PLAYED
	CPI	0FFH
	JNZ	NOHELP
	LXI	D, HELP
	CALL	ZSOUT

NOHELP:	CALL	EXIT

HELP:	DB	'ARGS: C=CONTINUOUS, M=MUTE', 0DH, 0AH
        DB      '      A=ACORN EXTERNAL, Z=ZERO EXTERNAL', 0DH, 0AH
	DB	'      T=TEST', 0DH, 0AH, 0

	; DUMP -- dumps part of the ACORN word from the ROM for debugging

DUMP:	LXI	B,0BB6H
DLP:	MOV	A,B
	CPI	00CH
	RZ
	CALL	TMSADR
	MVI	A,010H
	OUT	0B0H
	IN	0B0H
	CALL	PHEXA
	CALL	PSPACE
	INX	B		
	JMP	DLP

PLAYED: DB	0FFH

MAC:	DW	02409H  ; must
	DW	00BB6H  ; acorn
	DW	0FFFFH	

MTEST:	DW	03808H	; this
	DW	01F57H  ; is
	DW	00B5DH  ; a
	DW	02E3FH	; program
	DW	03153H	; running
	DW	02980H	; on
	DW	036DFH	; the
	DW	0140BH	; computer
	DW	0FFFFH  ; end

ACORN:  DW	LACORN
	DB      023H,09BH,035H,085H,0D3H,096H,09CH,064H
	DB	0D6H,012H,00AH,05FH,07CH,0A2H,095H,0D6H
        DB      030H,06CH,0F1H,089H,056H,018H,086H,0CCH
	DB	045H,02BH,05AH,0A1H,011H,02BH,01BH,0B7H
        DB      068H,034H,006H,0CFH,09EH,094H,0B2H,091H
	DB	019H,032H,0ABH,096H,02AH,084H,072H,077H
        DB      011H,0D9H,000H,00AH,008H,051H,0C9H,002H
	DB	025H,08FH,06DH,054H,04DH,066H,0B6H,022H
        DB      086H,009H,033H,0DAH,0D5H,0DAH,0E8H,02AH
	DB	0D3H,0B0H,04FH,0EBH,092H,0A9H,0CAH,0A0H
        DB      0BCH,06DH,048H,0A6H,02AH,083H,0F2H,095H
	DB	029H,0D9H,0ECH,034H,0ECH,09BH,0E6H,090H
        DB      0AAH,05DH,078H,073H,098H,063H,0C9H,074H
	DB	0D6H,057H,06EH,08EH,0CBH,042H,06CH,066H
        DB      0B9H,029H,00DH,04BH,0E6H,08EH,01BH,0C6H
	DB	094H,02CH,084H,0A2H,073H,098H,0B2H,071H
	DB	00BH,0F0H,0CCH,06EH,04EH,03AH,0D4H,0D8H
	DB	0B3H,0AAH,0B9H,068H,033H,023H,0D5H,0F2H
LACORN	EQU	$-ACORN

ZERO:	DW	LZERO
	DB      162,43,32,45,170,26,170,182
        DB      129,212,136,114,172,128,143,196
        DB      52,144,170,143,68,213,67,77
        DB      203,22,51,140,182,68,35,154
        DB      220,33,167,107,173,96,40,131
        DB      156,158,117,130,105,18,116,178
        DB      209,241,135,116,170,137,70,39
        DB      24,54,57,92,23,157,96,168
        DB      146,52,91,180,162,166,202,210
        DB      125,209,136,115,182,242,168,150
        DB      35,205,131,77,35,93,183,44
        DB      15,116,243,200,220,138,92,169
        DB      164,59,85,171,115,229,226,58
        DB      215,109,44,73,139,61,111,149
        DB      177,120,77,215,120,148,166,100
        DB      195,51,226,82,154,146,141,8
        DB      243,75,97,74,49,220,184,38
        DB      187,37,5,119,149,122,244,6
LZERO	EQU	$-ZERO

GOOD:
        DW      001FH
        DB      00AH, 028H, 0CDH, 034H, 020H, 0D9H, 01AH, 045H
        DB      074H, 0E4H, 066H, 024H, 0ADH, 0BAH, 0B1H, 08CH
        DB      09BH, 091H, 0A5H, 064H, 0E6H, 098H, 021H, 016H
        DB      00BH, 096H, 09BH, 04CH, 0E5H, 0FFH, 001H
MORNING:
        DW      008BH
        DB      0CEH, 008H, 052H, 02AH, 035H, 05DH, 039H, 053H
        DB      029H, 05BH, 0B7H, 00AH, 015H, 00CH, 0EEH, 02AH
        DB      042H, 056H, 066H, 0D2H, 055H, 02EH, 037H, 02FH
        DB      0D9H, 045H, 0B3H, 0D3H, 0C5H, 0CAH, 06DH, 027H
        DB      0D5H, 0EEH, 050H, 0F5H, 050H, 094H, 014H, 077H
        DB      02DH, 0D8H, 05DH, 049H, 092H, 0FDH, 0B1H, 064H
        DB      02FH, 0A9H, 049H, 00CH, 093H, 04BH, 0ADH, 019H
        DB      017H, 03EH, 066H, 01EH, 0F1H, 0A2H, 05BH, 084H
        DB      0E2H, 029H, 08FH, 08BH, 072H, 010H, 0B5H, 0B1H
        DB      02EH, 04BH, 0D4H, 045H, 089H, 04AH, 0ECH, 05CH
        DB      095H, 014H, 02BH, 08AH, 09CH, 034H, 052H, 05DH
        DB      0BCH, 0CCH, 0B5H, 03BH, 049H, 069H, 089H, 087H
        DB      0C1H, 098H, 056H, 03AH, 021H, 02BH, 082H, 067H
        DB      0CCH, 05CH, 085H, 0B5H, 04AH, 08AH, 0F6H, 064H
        DB      0A9H, 096H, 0C4H, 069H, 03CH, 052H, 081H, 058H
        DB      01CH, 097H, 0F6H, 00EH, 01BH, 0CCH, 00DH, 042H
        DB      032H, 0AAH, 065H, 012H, 067H, 0D4H, 06AH, 061H

	END	ORIG
